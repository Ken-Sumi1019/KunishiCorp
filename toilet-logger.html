<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>記録管理アプリ</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    .controls {
      margin-bottom: 20px;
    }
    /* 登録用の入力欄とボタン */
    #nameInput {
      padding: 5px;
      font-size: 16px;
    }
    button {
      margin: 2px;
      padding: 5px 8px;
      font-size: 16px;
    }
    /* 各人の列（カード）のレイアウト */
    #container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .column {
      border: 1px solid #ccc;
      padding: 10px;
      width: 200px;
      min-height: 300px;
      box-sizing: border-box;
    }
    .column h3 {
      margin-top: 0;
      text-align: center;
    }
    .buttons {
      text-align: center;
      margin-bottom: 10px;
    }
    /* 各記録のレイアウト */
    .record {
      border-bottom: 1px solid #ddd;
      padding: 5px 0;
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .record:last-child {
      border-bottom: none;
    }
    .record .timestamp {
      margin: 0 5px;
      white-space: nowrap;
    }
    .record .symbol {
      font-weight: bold;
      margin-left: auto;
    }
  </style>
</head>
<body>
  <h1>記録管理アプリ</h1>
  <div class="controls">
    <!-- 名前の登録部分 -->
    <input type="text" id="nameInput" placeholder="名前を入力">
    <button id="registerNameBtn">登録</button>
    <!-- 削除ボタン（チェックした記録を一括削除） -->
    <button id="deleteRecordsBtn">削除</button>
  </div>
  <!-- 各人の列を配置するコンテナ -->
  <div id="container"></div>
  
  <script>
    // データ構造：各人の名前とその記録を管理する
    let data = { persons: [] };

    // localStorageから状態を読み込む
    function loadData() {
      const saved = localStorage.getItem("recordData");
      if (saved) {
        data = JSON.parse(saved);
      }
    }

    // 状態をlocalStorageに保存する
    function saveData() {
      localStorage.setItem("recordData", JSON.stringify(data));
    }

    // UIの再描画：各人の列（カード）を作成する
    function render() {
      const container = document.getElementById("container");
      container.innerHTML = "";
      data.persons.forEach((person, pIndex) => {
        // 各人の列（カード）を生成
        const column = document.createElement("div");
        column.className = "column";
        column.setAttribute("data-person-index", pIndex);

        // 名前の見出し
        const header = document.createElement("h3");
        header.textContent = person.name;
        column.appendChild(header);

        // ボタン群（◯, △, □）の作成
        const btnContainer = document.createElement("div");
        btnContainer.className = "buttons";
        ["◯", "△", "□"].forEach(symbol => {
          const btn = document.createElement("button");
          btn.textContent = symbol;
          btn.addEventListener("click", function() {
            addRecord(pIndex, symbol);
          });
          btnContainer.appendChild(btn);
        });
        column.appendChild(btnContainer);

        // 各記録のリスト
        const recordsContainer = document.createElement("div");
        recordsContainer.className = "records";
        person.records.forEach(record => {
          const recDiv = document.createElement("div");
          recDiv.className = "record";
          // 各記録にユニークなIDをdata属性として保持
          recDiv.setAttribute("data-record-id", record.id);

          // 削除用チェックボックス
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "deleteCheckbox";
          recDiv.appendChild(checkbox);

          // 時刻表示（mm/dd hh:mm形式）
          const timeSpan = document.createElement("span");
          timeSpan.className = "timestamp";
          timeSpan.textContent = record.timestamp;
          recDiv.appendChild(timeSpan);

          // 押したボタンの記号表示
          const symbolSpan = document.createElement("span");
          symbolSpan.className = "symbol";
          symbolSpan.textContent = record.symbol;
          recDiv.appendChild(symbolSpan);

          recordsContainer.appendChild(recDiv);
        });
        column.appendChild(recordsContainer);
        container.appendChild(column);
      });
    }

    // 新規の人を追加する関数
    function addPerson(name) {
      if (!name) return;
      data.persons.push({ name: name, records: [] });
      saveData();
      render();
    }

    // ボタン押下により記録を追加する関数（時刻の形式を mm/dd hh:mm に変更）
    function addRecord(personIndex, symbol) {
      const now = new Date();
      const month = ('0' + (now.getMonth() + 1)).slice(-2);
      const day = ('0' + now.getDate()).slice(-2);
      const hour = ('0' + now.getHours()).slice(-2);
      const minute = ('0' + now.getMinutes()).slice(-2);
      const timestamp = month + '/' + day + ' ' + hour + ':' + minute;
      
      // ユニークなIDとして日時（ミリ秒）と乱数を組み合わせる
      const record = {
        id: Date.now() + Math.floor(Math.random() * 1000),
        timestamp: timestamp,
        symbol: symbol
      };
      data.persons[personIndex].records.push(record);
      saveData();
      render();
    }

    // 削除ボタン押下時の、チェック済み記録の削除処理
    function deleteRecords() {
      data.persons.forEach((person, pIndex) => {
        // 該当の人の列（カード）を取得
        const column = document.querySelector(`.column[data-person-index="${pIndex}"]`);
        if (column) {
          const recordsDiv = column.querySelector(".records");
          // 各記録のDOM要素を取得
          const recordDivs = recordsDiv.querySelectorAll(".record");
          recordDivs.forEach(recordDiv => {
            const checkbox = recordDiv.querySelector(".deleteCheckbox");
            if (checkbox.checked) {
              const recId = recordDiv.getAttribute("data-record-id");
              // 対応する記録を削除（IDで一致するものを削除）
              person.records = person.records.filter(r => String(r.id) !== recId);
            }
          });
        }
      });
      saveData();
      render();
    }

    // 各種イベントリスナーの設定
    document.getElementById("registerNameBtn").addEventListener("click", function() {
      const nameInput = document.getElementById("nameInput");
      const name = nameInput.value.trim();
      if (name !== "") {
        addPerson(name);
        nameInput.value = "";
      }
    });

    document.getElementById("deleteRecordsBtn").addEventListener("click", function() {
      deleteRecords();
    });

    // 初期化：localStorageから読み込み＆描画
    loadData();
    render();
  </script>
</body>
</html>
